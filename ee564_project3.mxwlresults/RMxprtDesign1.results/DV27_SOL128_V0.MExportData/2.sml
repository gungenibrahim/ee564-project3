//         Left: A B C N
//        Right: ROT1 ROT2 Pos

// A           : Phase A
// B           : Phase B
// C           : Phase C
// N           : Neutral
// ROT1        : Mechanical plus
// ROT2        : Mechanical minus
// Pos         : Position

MODELDEF Setup2
{
PORT electrical: A;
PORT electrical: B;
PORT electrical: C;
PORT electrical: N;
PORT ROTATIONAL_V: ROT1;
PORT ROTATIONAL_V: ROT2;
PORT REAL OUT ANGLE[deg]: Pos = VM_Pos.V;
PORT REAL IN ANGLE[deg]: IniPos = 0;

INTERN  R        Ra  N1:=A, N2:=N0_1  ( R:=0.00402947 ); 
INTERN  R        Rb  N1:=B, N2:=N0_2  ( R:=0.00402947 ); 
INTERN  R        Rc  N1:=C, N2:=N0_3  ( R:=0.00402947 ); 
UMODEL Transformation_3To2 AB0 NAP:=N0_1, NAN:=N, NBP:=N0_2, NBN:=N, NCP:=N0_3, NCN:=N, NALPHA:=alpha, NBETA:=beta, NZERO:=zero () SRC: DLL( File:="Transformation.dll");

INTERN  EV       Speed  N1:=NM_1, N2:=GND  ( QUANT:=Torq.V, FACT:=1 ); 
INTERN  II       Torq  N1:=NM_6, N2:=NM_5  ( QUANT:=Speed.I, FACT:=1 ); 
UMODEL D2D D2D1 N1:=NM_5, N2:=ROT1 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
UMODEL D2D D2D2 N1:=NM_6, N2:=ROT2 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
INTERN  VM       VM_Pos  N1:=NM_2, N2:=GND  ; 
MODEL Setup2_AB0 model1 N_1:=alpha, N_2:=beta, N_3:=zero, N_4:=NM_1, N_5:=NM_2 ( pos0:=IniPos );


//         Left: N_1 N_2 N_3
//        Right: N_4 N_5

MODELDEF Setup2_AB0
{
PORT electrical: N_1;
PORT electrical: N_4;
PORT electrical: N_2;
PORT electrical: N_5;
PORT electrical: N_3;
PORT REAL IN: pos0 = 0;

INTERN  L        L1d  N1:=N_1, N2:=N_8  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmd  N1:=N_8, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfed  N1:=N_8, N2:=GND  ( R:=1.57161e+006 ); 
INTERN  L        L2d  N1:=N_9, N2:=N_8  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2d  N1:=N_10, N2:=N_9  ( R:=0.0715814 ); 
INTERN  E        B2d  N1:=N_10, N2:=N_11  ( EMF:=4 * N_42.V * N_4.V * L2q.I, PARTDERIV:=1 ); 
INTERN  L        L2td  N1:=N_12, N2:=N_11  ( L:=9.88481e-005, I0:=0 ); 
INTERN  L        L2bd  N1:=N_13, N2:=N_11  ( L:=0.000390974, I0:=0 ); 
INTERN  M        K2d  ( L1:= L2td.L, L2:= L2bd.L, K:=0.630066 ); 
INTERN  R        R2td  N1:=N_14, N2:=N_12  ( R:=0.00348451 ); 
INTERN  R        R2bd  N1:=N_15, N2:=N_13  ( R:=0.00149336 ); 
INTERN  E        B2ttd  N1:=N_14, N2:=N_16  ( EMF:=0.000395392 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2btd  N1:=N_15, N2:=N_17  ( EMF:=0.000495455 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2tbd  N1:=N_16, N2:=N_18  ( EMF:=0.000495455 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        B2bbd  N1:=N_17, N2:=N_18  ( EMF:=0.0015639 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        Bmd  N1:=N_18, N2:=GND  ( EMF:=4 * N_43.V * N_4.V * Lmq.I, PARTDERIV:=1 ); 
INTERN  L        L1q  N1:=N_2, N2:=N_28  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmq  N1:=N_28, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfeq  N1:=N_28, N2:=GND  ( R:=1.57161e+006 ); 
INTERN  L        L2q  N1:=N_29, N2:=N_28  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2q  N1:=N_30, N2:=N_29  ( R:=0.0715814 ); 
INTERN  E        B2q  N1:=N_30, N2:=N_31  ( EMF:=-4 * N_42.V * N_4.V * L2d.I, PARTDERIV:=1 ); 
INTERN  L        L2tq  N1:=N_32, N2:=N_31  ( L:=9.88481e-005, I0:=0 ); 
INTERN  L        L2bq  N1:=N_33, N2:=N_31  ( L:=0.000390974, I0:=0 ); 
INTERN  M        K2q  ( L1:= L2tq.L, L2:= L2bq.L, K:=0.630066 ); 
INTERN  R        R2tq  N1:=N_34, N2:=N_32  ( R:=0.00348451 ); 
INTERN  R        R2bq  N1:=N_35, N2:=N_33  ( R:=0.00149336 ); 
INTERN  E        B2ttq  N1:=N_34, N2:=N_36  ( EMF:=-0.000395392 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2btq  N1:=N_35, N2:=N_37  ( EMF:=-0.000495455 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2tbq  N1:=N_36, N2:=N_38  ( EMF:=-0.000495455 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        B2bbq  N1:=N_37, N2:=N_38  ( EMF:=-0.0015639 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        Bmq  N1:=N_38, N2:=GND  ( EMF:=-4 * N_43.V * N_4.V * Lmd.I, PARTDERIV:=1 ); 
INTERN  L        L0  N1:=N_3, N2:=GND  ( L:=0.000255423, I0:=0 ); 
INTERN  I        BT  N1:=GND, N2:=N_4  ( IS:=4 * N_43.V * (L2d.I*Lmq.I - L2q.I*Lmd.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Speed  N1:=N_4, N2:=GND  ; 
INTERN  IV       Gx  N1:=GND, N2:=N_55  ( QUANT:=VM_Speed.V, FACT:=1 ); 
INTERN  C        Cx  N1:=N_55, N2:=GND  ( C:=1, V0:=pos0*0.0174533 ); 
INTERN  VM       VM_Pos  N1:=N_55, N2:=GND  ; 
INTERN  EV       Ex2  N1:=GND, N2:=N_5  ( QUANT:=VM_Pos.V, FACT:=57.2958 ); 
INTERN  E        BIsr  N1:=GND, N2:=N_39  ( EMF:=sqrt(L1d.I*L1d.I + L1q.I*L1q.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Isr  N1:=N_39, N2:=GND  ; 
INTERN  E        BIm  N1:=GND, N2:=N_40  ( EMF:=sqrt(Lmd.I*Lmd.I + Lmq.I*Lmq.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Im  N1:=N_40, N2:=GND  ; 
INTERN  VM       VM_L1  N1:=N_41, N2:=GND  ; 
INTERN  NDSRC    PL1 N0:=N_41, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup2_l1_table pwl TABLE=( 51, 0, 57.6291, 115.258, 172.887, 230.516,\
 288.145, 345.774, 403.404, 461.033, 518.662, 576.291, 633.92, 691.549,\
 749.178, 806.807, 864.436, 922.065, 979.694, 1037.32, 1094.95, 1152.58,\
 1210.21, 1267.84, 1325.47, 1383.1, 1440.73, 1498.36, 1555.98, 1613.61,\
 1671.24, 1728.87, 1786.5, 1844.13, 1901.76, 1959.39, 2017.02, 2074.65,\
 2132.28, 2189.9, 2247.53, 2305.16, 2362.79, 2420.42, 2478.05, 2535.68,\
 2593.31, 2650.94, 2708.57, 2766.2, 2823.82, 2881.45, 1, 0.000256867,\
 0.000256692, 0.000256518, 0.000256344, 0.00025617, 0.000255909, 0.000255565,\
 0.000255224, 0.000254884, 0.000254536, 0.000253766, 0.000253005, 0.000252254,\
 0.000251511, 0.000250153, 0.000247277, 0.000243952, 0.000240759, 0.000237695,\
 0.000235102, 0.000232571, 0.000230095, 0.000227667, 0.000225283, 0.000222938,\
 0.000220627, 0.000218347, 0.000216133, 0.000214475, 0.00021283, 0.000211198,\
 0.000209577, 0.000207967, 0.000206367, 0.000204777, 0.000203195, 0.000201667,\
 0.00020063, 0.000199596, 0.000198565, 0.000197537, 0.000196513, 0.000195491,\
 0.000194472, 0.000193455, 0.000192494, 0.000191971, 0.000191448, 0.000190927,\
 0.000190406, 0.000189885) CONSTANT NOSPLINE" );
INTERN  VM       VM_L2  N1:=N_42, N2:=GND  ; 
INTERN  NDSRC    PL2 N0:=N_42, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup2_l2_table pwl TABLE=( 51, 0, 57.6291, 115.258, 172.887, 230.516,\
 288.145, 345.774, 403.404, 461.033, 518.662, 576.291, 633.92, 691.549,\
 749.178, 806.807, 864.436, 922.065, 979.694, 1037.32, 1094.95, 1152.58,\
 1210.21, 1267.84, 1325.47, 1383.1, 1440.73, 1498.36, 1555.98, 1613.61,\
 1671.24, 1728.87, 1786.5, 1844.13, 1901.76, 1959.39, 2017.02, 2074.65,\
 2132.28, 2189.9, 2247.53, 2305.16, 2362.79, 2420.42, 2478.05, 2535.68,\
 2593.31, 2650.94, 2708.57, 2766.2, 2823.82, 2881.45, 1, 0.000220536,\
 0.000220109, 0.000219684, 0.000219263, 0.000218844, 0.000218217, 0.000217397,\
 0.000216587, 0.000215788, 0.000214977, 0.000213199, 0.000211469, 0.000209782,\
 0.000208137, 0.000205182, 0.00019911, 0.00019235, 0.000186058, 0.00018016,\
 0.00017525, 0.000170513, 0.000165923, 0.000161455, 0.000157091, 0.000152816,\
 0.000148618, 0.000144487, 0.000140481, 0.000137486, 0.000134517, 0.000131571,\
 0.000128648, 0.000125744, 0.000122859, 0.000119991, 0.000117139, 0.000114383,\
 0.000112512, 0.000110646, 0.000108786, 0.000106931, 0.000105081, 0.000103235,\
 0.000101394, 9.95575e-005, 9.78202e-005, 9.68749e-005, 9.59306e-005,\
 9.49874e-005, 9.40451e-005, 9.31038e-005) CONSTANT NOSPLINE" );
INTERN  VM       VM_Lm  N1:=N_43, N2:=GND  ; 
INTERN  NDSRC    PLm N0:=N_43, N1:=GND  ( QUANT:={N_40.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup2_lm_table pwl TABLE=( 51, 0, 2.39204, 4.78408, 7.17612, 9.56816,\
 11.9602, 14.3522, 16.7443, 19.1363, 21.5284, 23.9204, 26.3124, 28.7045,\
 31.0965, 33.4886, 35.8806, 38.2726, 40.6647, 43.0567, 45.4488, 47.8408,\
 50.2328, 52.6249, 55.0169, 57.409, 59.801, 62.193, 64.5851, 66.9771, 69.3692,\
 71.7612, 74.1532, 76.5453, 78.9373, 81.3294, 83.7214, 86.1134, 88.5055,\
 90.8975, 93.2042, 95.3576, 103.853, 112.587, 121.573, 130.715, 139.828,\
 148.91, 157.806, 166.646, 175.54, 184.417, 1, 0.013307, 0.013307, 0.013307,\
 0.013307, 0.013307, 0.013307, 0.013307, 0.013307, 0.013307, 0.013307,\
 0.013307, 0.013307, 0.013307, 0.013307, 0.013307, 0.013307, 0.013307,\
 0.013307, 0.013307, 0.013307, 0.013307, 0.013307, 0.013307, 0.013307,\
 0.013307, 0.013307, 0.013307, 0.013307, 0.013307, 0.013307, 0.013307,\
 0.013307, 0.013307, 0.013307, 0.013307, 0.013307, 0.013307, 0.013307,\
 0.013307, 0.0133192, 0.0133523, 0.013486, 0.0135707, 0.0136149, 0.0136368,\
 0.0136587, 0.0136806, 0.0137163, 0.0137527, 0.0137812, 0.0138082) CONSTANT\
 NOSPLINE" );
}

}
